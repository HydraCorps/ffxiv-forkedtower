name: Deploy MKDocs to Azure Static Webapp

on:
  workflow_dispatch:
  workflow_call:
  push:
    branches: [ main ]
    paths:
      - '**'

jobs:
  deploy-documentation:
    name: Deploy MkDocs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install MkDocs on agent
        run: | 
            pip install playwright
            playwright install chromium --with-deps
            pip install mkdocs \
                mkdocs-material \
                mkdocs-awesome-pages-plugin \
                mkdocs-table-reader-plugin \
                openpyxl \
                mkdocs-macros-plugin \
                mkdocs-autolinks-plugin \
                mkdocs-redirects \
                mkdocs-backlinks-section-plugin \
                mkdocs-open-in-new-tab \
                mkdocs-exporter \
                mkdocs-meta-manager\
                mkdocs-glightbox

      #https://github.com/lukasgeiter/mkdocs-awesome-pages-plugin

      - name: Build documentation
        run: |
          mkdocs build -f ./mkdocs.yml   -d ../site

      #https://learn.microsoft.com/en-us/azure/static-web-apps/build-configuration?tabs=github-actions#build-and-deploy
      - name: Build And Deploy
        id: builddeploy
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
          action: "upload"
          app_location: "/site" # App source code path relative to repository root
          output_location: "" # Built app content directory, relative to app_location - optional
